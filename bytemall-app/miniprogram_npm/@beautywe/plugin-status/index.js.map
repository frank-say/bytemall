{"version":3,"sources":["status.plugin.js","status.js","../package.json"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["\n\nvar _status = _interopRequireDefault(require(\"./status\"));\n\nvar _package = _interopRequireDefault(require(\"../package.json\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nmodule.exports = function status() {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return {\n    name: 'status',\n    npmName: _package[\"default\"].name,\n    version: _package[\"default\"].version,\n    relyOn: [{\n      name: 'event',\n      npmName: '@beautywe/plugin-event'\n    }],\n    nativeHook: {\n      onLaunch: function onLaunch() {\n        this.status.initStatus();\n      },\n      onLoad: function onLoad() {\n        this.status.initStatus();\n      }\n    },\n    customMethod: {\n      get: function get(name) {\n        return this.status._statuses[name];\n      },\n      remove: function remove(name) {\n        delete this.status._statuses[name];\n      },\n      add: function add(name) {\n        if (!this.status._statuses) this.status._statuses = {};\n        if (!this.status._statuses[name]) this.status._statuses[name] = new _status[\"default\"](name, {\n          theHost: this\n        });\n        return this.status._statuses[name];\n      },\n      initStatus: function initStatus() {\n        var _this = this;\n\n        if (options.statuses && Array.isArray(options.statuses)) {\n          options.statuses.forEach(function (statusName) {\n            return _this.status.add(statusName);\n          });\n        }\n      }\n    }\n  };\n};","\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _core = require(\"@beautywe/core\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar logger = new _core.Logger({\n  prefix: 'beautywe-plugin-evet'\n});\n\nvar Status =\n/*#__PURE__*/\nfunction () {\n  function Status(name, _ref) {\n    var theHost = _ref.theHost;\n\n    _classCallCheck(this, Status);\n\n    this.name = name;\n    this.statusVar = {\n      FAIL: -1,\n      UN_START: 0,\n      ING: 1,\n      SUCCESS: 2\n    };\n    this.status = this.statusVar.UN_START;\n    this.theHost = theHost;\n  } // 改变状态：成功\n\n\n  _createClass(Status, [{\n    key: \"success\",\n    value: function success(params) {\n      logger.info('status:success', \"\\u72B6\\u6001\\u5668(\".concat(this.name, \") \\u542F\\u52A8\\u6210\\u529F\"));\n      this.status = this.statusVar.SUCCESS;\n      this.theHost.event.trigger(this.getEventKeyByStatus(this.statusVar.SUCCESS), params);\n    } // 改变状态：失败\n\n  }, {\n    key: \"fail\",\n    value: function fail(error) {\n      logger.info('status:fail', \"\\u72B6\\u6001\\u5668(\".concat(this.name, \") \\u542F\\u52A8\\u5931\\u8D25\"));\n      this.status = this.statusVar.FAIL;\n      this.theHost.event.trigger(this.getEventKeyByStatus(this.statusVar.FAIL), error);\n    } // 改变状态：进行中\n\n  }, {\n    key: \"ing\",\n    value: function ing() {\n      this.status = this.statusVar.ING;\n    } // 改变状态：重置\n\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      this.status = this.statusVar.UN_START;\n    } // 一定是成功之后，才会返回。\n\n  }, {\n    key: \"must\",\n    value: function must() {\n      var _this = this;\n\n      if (this.status === this.statusVar.SUCCESS) return Promise.resolve();\n      return Promise.resolve().then(function () {\n        return new Promise(function (resolve, reject) {\n          _this.theHost.event.once(_this.getEventKeyByStatus(_this.statusVar.SUCCESS), resolve);\n\n          _this.theHost.event.once(_this.getEventKeyByStatus(_this.statusVar.FAIL), reject);\n        });\n      })[\"catch\"](function (error) {\n        // 失败了，打印错误，继续监听下一次状态。\n        logger.warn('status:must:fail', \"\\u72B6\\u6001\\u5668(\".concat(_this.name, \")\\u542F\\u52A8\\u5931\\u8D25)\"), error);\n        return _this.must();\n      });\n    } // 监听后续的一次成功事件\n\n  }, {\n    key: \"onceSuccess\",\n    value: function onceSuccess() {\n      var _this2 = this;\n\n      return new Promise(function (resolve) {\n        _this2.theHost.event.once(_this2.getEventKeyByStatus(_this2.statusVar.SUCCESS), resolve);\n      });\n    } // 监听后续的一次失败事件\n\n  }, {\n    key: \"onceFail\",\n    value: function onceFail() {\n      var _this3 = this;\n\n      return new Promise(function (resolve) {\n        _this3.theHost.event.once(_this3.getEventKeyByStatus(_this3.statusVar.FAIL), resolve);\n      });\n    } // 是否在进行中\n\n  }, {\n    key: \"isIng\",\n    value: function isIng() {\n      return this.status === this.statusVar.ING;\n    } // 是否已经成功\n\n  }, {\n    key: \"isSuccess\",\n    value: function isSuccess() {\n      return this.status === this.statusVar.SUCCESS;\n    } // 是否已经失败\n\n  }, {\n    key: \"isFail\",\n    value: function isFail() {\n      return this.status === this.statusVar.FAIL;\n    } // 获取状态器的 key\n\n  }, {\n    key: \"getEventKeyByStatus\",\n    value: function getEventKeyByStatus(status) {\n      return \"\".concat(this.name, \":\").concat(status);\n    }\n  }]);\n\n  return Status;\n}();\n\nvar _default = Status;\nexports[\"default\"] = _default;","module.exports = {\n  \"name\": \"@beautywe/plugin-status\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Status plugin for beautywe\",\n  \"main\": \"dist/status.plugin.js\",\n  \"scripts\": {\n    \"test\": \"nyc ava test/**/*.test.js\",\n    \"test:report\": \"nyc report --reporter=html\",\n    \"test:coverage\": \"nyc --reporter=html ava\",\n    \"build:pro\": \"rm -rf ./dist && node_modules/.bin/babel src -d dist\",\n    \"build:watch\": \"babel src --watch -d dist\",\n    \"code-check\": \"eslint src/**\",\n    \"code-fix\": \"eslint --fix src/**\",\n    \"lint\": \"git diff --cached --name-only | grep -E '\\\\.(js|jsx)$' | xargs eslint\",\n    \"commitmsg\": \"validate-commit-msg\",\n    \"commit\": \"git cz\"\n  },\n  \"keywords\": [\n    \"beautywe\",\n    \"beautywe-plugin\"\n  ],\n  \"author\": \"JerryC8080 (huangjerryc@gmail.com)\",\n  \"devDependencies\": {\n    \"@beautywe/plugin-event\": \"^1.0.0\",\n    \"@babel/register\": \"^7.4.0\",\n    \"@babel/cli\": \"^7.0.0\",\n    \"@babel/core\": \"^7.0.0\",\n    \"@babel/preset-env\": \"^7.0.0\",\n    \"ava\": \"^1.4.1\",\n    \"babel-eslint\": \"^9.0.0\",\n    \"babel-plugin-array-includes\": \"^2.0.3\",\n    \"babel-plugin-istanbul\": \"^5.1.0\",\n    \"commitizen\": \"^3.0.5\",\n    \"eslint\": \"^2.13.1\",\n    \"eslint-config-airbnb\": \"^9.0.1\",\n    \"eslint-plugin-import\": \"^1.12.0\",\n    \"eslint-plugin-jsx-a11y\": \"^2.0.1\",\n    \"eslint-plugin-react\": \"^5.2.2\",\n    \"nyc\": \"^13.1.0\",\n    \"pre-commit\": \"^1.2.2\",\n    \"validate-commit-msg\": \"^2.14.0\"\n  },\n  \"dependencies\": {\n    \"@beautywe/core\": \"^1.0.0\"\n  },\n  \"config\": {\n    \"commitizen\": {\n      \"path\": \"./node_modules/cz-conventional-changelog\"\n    }\n  },\n  \"ava\": {\n    \"require\": [\n      \"@babel/register\"\n    ]\n  },\n  \"nyc\": {\n    \"sourceMap\": false,\n    \"instrument\": false\n  },\n  \"directories\": {\n    \"test\": \"test\"\n  },\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git+https://github.com/beautywe/plugin-status.git\"\n  },\n  \"license\": \"MIT\",\n  \"bugs\": {\n    \"url\": \"https://github.com/beautywe/plugin-status/issues\"\n  },\n  \"homepage\": \"https://github.com/beautywe/plugin-status#readme\"\n}\n"]}